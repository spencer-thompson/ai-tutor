(()=>{const e=window.location.origin,t=(window.location.pathname,window.location.hostname.split(".")[0]);async function s(e){let t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});return await t.json()}!async function(){let i=await s(`${e}/api/v1/users/self`),n=await s(`${e}/api/v1/users/self/activity_stream?only_active_courses=true`),a=await s(`${e}/api/v1/courses?enrollment_state=active&include[]=concluded&include[]=total_scores&include[]=computed_current_score&include[]=syllabus_body&include[]=public_description&per_page=100`),o=a.map((({id:e,name:t,syllabus_body:s})=>({id:e,name:t,...null!==s&&{syllabus_body:s}})));for(let i=0;i<o.length;i++){let n=(await s(`${e}/api/v1/courses/${o[i].id}/assignments?bucket=upcoming&order_by=due_at&include[]=score_statistics`)).map((({id:e,name:t,description:s,due_at:i,updated_at:n,points_possible:a,html_url:o,rubric:l,lock_at:c,unlock_at:d,locked_for_user:r,submission_types:u})=>({id:e,name:t,description:s,...null!==i&&{due_at:i},updated_at:n,...null!==a&&{points_possible:a},html_url:o,...l?.length>0&&{rubric:l.map((({description:e,points:t})=>({description:e,points:t})))},...null!==c&&{lock_at:c},...null!==d&&{unlock_at:d},locked_for_user:r,submission_types:u})));o[i].assignments=n,o[i].institution=t,chrome.runtime.sendMessage({type:"sendCourse",data:o[i]})}let l={institution:t,canvas_id:i.id,first_name:i.first_name,last_name:i.last_name,avatar_url:i.avatar_url,courses:a.map((({id:e,name:s,enrollments:i})=>({institution:t,id:e,name:s,role:i[0].type,...null!=i[0].computed_current_score&&{current_score:i[0].computed_current_score}}))),activity_stream:n.map((({id:e,type:t,title:s,message:i,html_url:n,course_id:a,created_at:o,updated_at:l,read_state:c,late:d,seconds_late:r,missing:u,score:_,assignment_id:m,assignment:p,submission_comments:b})=>({id:e,kind:t,title:s,...null!==i&&{message:i},html_url:n,course_id:a,created_at:o,updated_at:l,read_state:c,...void 0!==d&&{late:d},...void 0!==r&&{seconds_late:r},...void 0!==u&&{missing:u},...void 0!==_&&{score:_},...void 0!==m&&{assignment_id:m},...void 0!==p?.points_possible&&{points_possible:p.points_possible},...b?.length>0&&{submission_comments:b.map((({author_name:e,comment:t})=>({author_name:e,comment:t})))}})))};chrome.runtime.sendMessage({type:"sendUser",data:l});const c={sub:l.canvas_id,uni:t};chrome.runtime.sendMessage({type:"setCookie",data:c})}()})();